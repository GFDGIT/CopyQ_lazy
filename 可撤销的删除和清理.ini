[Commands]
1\Name=\x64a4\x9500\x5220\x9664
1\Command="
    copyq:
    var trash_tab = '\x56de\x6536\x7ad9'
    var tab_mime = 'application/x-copyq-user-tab'
    var index_mime = 'application/x-copyq-user-index'
    var time_mime = 'application/x-copyq-user-time'
    var remove_mime = [tab_mime, index_mime, time_mime]
    tab(trash_tab)
    if (length() == 0) {
        popup('\x6ca1\x6709\x53ef\x64a4\x9500\x7684\x5220\x9664\xff01')
        abort()
    }
    var item = getItem(0)
    var target_tab = str(item[tab_mime]) || selectedtab()
    var time = str(item[time_mime])
    var items = []
    tab(trash_tab)
    var target_index = 999999
    var i = 0
    while (true) {
        target_index = Math.min(target_index, item[index_mime] || 0)
        for (var j in remove_mime)
            delete item[remove_mime[j]]
        items.push(item)
        item = getitem(++i)
        if ( !time || time !== str(item[time_mime]) )
            break;
    }
    var select_items = []
    var remove_items = []
    for (var j = 0; j < i; ++j) {
        select_items.push(target_index + j)
        remove_items.push(j)
    }
    show(target_tab)
    tab(target_tab)
    items.unshift(target_index)
    insert.apply(this, items)
    selectItems.apply(this, select_items)
    tab(trash_tab)
    remove.apply(this, remove_items)"
1\InMenu=true
1\Icon=\xf0e2
1\Shortcut=ctrl+z
2\Name=\x5220\x9664\x81f3\x56de\x6536\x7ad9
2\Command="
    copyq:
    var trash_tab = '\x56de\x6536\x7ad9'
    var tab_mime = 'application/x-copyq-user-tab'
    var index_mime = 'application/x-copyq-user-index'
    var time_mime = 'application/x-copyq-user-time'

    var source_tab = selectedtab()
    var time = (new Date).toISOString()

    tab(source_tab)
    var sel = ItemSelection().current()
    var pinned = []
    const rows = sel.rows()
    if (rows.length === 0)
        abort()
    if (source_tab != trash_tab) {
        var trashed = []
        for (var i = 0; i < sel.length; ++i) {
            if (plugins.itempinned.isPinned(rows[i])) {
                pinned.push(i)
            }
            else {
                var item = sel.itemAtIndex(i)
                // Workaround: Convert QByteArray to ByteArray.
                for (var format in item)
                    item[format] = ByteArray(item[format])
                item[tab_mime] = source_tab
                item[index_mime] = rows[i]
                item[time_mime] = time
                trashed.push(item)
            }
        }
        if (pinned.length > 0) {
            sel.deselectIndexes(pinned)
            for (var i = 0; i < pinned.length; i++) {
              pinned[i] = pinned[i] + 1
            }
            popup('\x56fa\x5b9a\x7684\x6761\x76ee\x4e0d\x4f1a\x88ab\x5220\x9664  ', '\x9009\x62e9\x4e2d\x7684\x7b2c ' + pinned + ' \x6761\x5df2\x56fa\x5b9a\x3002', time = 2000)
        }
        tab(trash_tab)
        write(0, trashed)
        tab(source_tab)
        sel.removeAll()
    }
    else {
        var text = dialog(
            '.title', '\x5220\x9664\xff1f',
            '.label', '\x65e0\x6cd5\x64a4\x9500\xff01',
            '.combo:\x786e\x8ba4 ', ['\x662f', '\x5426']
        )
        if (text == '\x662f') {
            sel.removeAll()
        }
    }

    var newCurrentRow = rows[0]
    if (newCurrentRow >= length())
        newCurrentRow = length() - 1
    selectItems(newCurrentRow)"
2\InMenu=true
2\Icon=\xf2ed
2\Shortcut=del
3\Name=\x6e05\x7406\x5f53\x524d\x6807\x7b7e\x9875
3\MatchCommand="
    copyq: tab(selectedTab()); if (size() == 0) fail()"
3\Command="
    copyq:
    var trash_tab = '\x56de\x6536\x7ad9'
    var tab_mime = 'application/x-copyq-user-tab'
    var index_mime = 'application/x-copyq-user-index'
    var time_mime = 'application/x-copyq-user-time'

    var source_tab = selectedtab()
    var time = (new Date).toISOString()

    tab(source_tab)
    var sel = ItemSelection(selectedTab()).selectRemovable()
    var pinned = []
    const rows = sel.rows()
    if (rows.length === 0)
        abort()
    if (source_tab != trash_tab) {
        var trashed = []
        for (var i = 0; i < sel.length; ++i) {
            if (plugins.itempinned.isPinned(rows[i])) {
                pinned.push(i)
            }
            else {
                var item = sel.itemAtIndex(i)
                // Workaround: Convert QByteArray to ByteArray.
                for (var format in item)
                    item[format] = ByteArray(item[format])
                item[tab_mime] = source_tab
                item[index_mime] = rows[i]
                item[time_mime] = time
                trashed.push(item)
            }
        }
        if (pinned.length > 0) {
            sel.deselectIndexes(pinned)
            for (var i = 0; i < pinned.length; i++) {
              pinned[i] = pinned[i] + 1
            }
            popup('\x56fa\x5b9a\x7684\x6761\x76ee\x4e0d\x4f1a\x88ab\x5220\x9664  ', '\x7b2c ' + pinned + ' \x6761\x5df2\x56fa\x5b9a\x3002', time = 2000)
        }
        tab(trash_tab)
        write(0, trashed)
        tab(source_tab)
        sel.removeAll()
    }
    else {
        var text = dialog(
            '.title', '\x6e05\x7406\xff1f',
            '.label', '\x65e0\x6cd5\x64a4\x9500\xff01',
            '.combo:\x786e\x8ba4 ', ['\x662f', '\x5426']
        )
        if (text == '\x662f') {
            ItemSelection(selectedTab()).selectRemovable().removeAll()
        }
    }

    var newCurrentRow = rows[0]
    if (newCurrentRow >= length())
        newCurrentRow = length() - 1
    selectItems(newCurrentRow)"
3\InMenu=true
3\Icon=\xf51a
size=3