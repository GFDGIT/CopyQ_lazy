[Commands]
1\Name=\x641c\x7d22\x6240\x6709\x6807\x7b7e\x9875
1\Command="
    copyq:
    // \x9ed8\x8ba4\x5feb\x6377\x952e\x4e0eWin10\x81ea\x5e26\x8f93\x5165\x6cd5\x7684\x7b80\x7e41\x5207\x6362\x5feb\x6377\x952e\x51b2\x7a81\xff0c\x8bf7\x81ea\x884c\x8c03\x6574
    // Name for tab for storing matching items.
    var search_tab_name = \"\x5168\x5c40\x641c\x7d22\"
    // Returns true if item at index matches regex.
    function item_matches(item_index, re)
    {
        var item = getitem(j)
        var note = str(item[mimeItemNotes])
        var text = str(item[mimeText])
        return text && (re.test(text) || re.test(note))
    }
    // Ask for search expression.
    var match = dialog(\"\x641c\x7d22\")
    if (!match)
      abort()
    var re = new RegExp(match,'i') // 'i' case-insensitive
    // Clear tab with results.
    try {
      removeTab(search_tab_name)
    } catch (e) {}
    // Search all tabs.
    var tab_names = tab()
    for (var i in tab_names) {
      var tab_name = tab_names[i]
      tab(tab_name)
      var item_count = count()
      // Search all items in tab.
      for (var j = 0; j < item_count; ++j) {
        // Add matching item to tab with results.
        if (item_matches(j, re)) {
          var item = getItem(j)
          tab(search_tab_name)
          setItem(j, item)
          tab(tab_name)
        }
      }
    }
    show(search_tab_name)"
1\InMenu=true
1\Icon=\xf002
1\Shortcut=ctrl+shift+f
2\Name=\x7b5b\x9009|\x65e0
2\Command="
    copyq:
    filter('')"
2\InMenu=true
2\Icon=\xe17b
2\Shortcut=n
3\Name=\x7b5b\x9009|\x56fe\x7247
3\Command="
    copyq:
    var filter_ = '(^image/.*)|(?=^file\\:.*\\.[png|jpe?g|bmp|svg|gif]$)'
    if (filter() == filter_)
      filter('')
    else
      filter('') & filter(filter_)"
3\InMenu=true
3\Icon=\xf302
3\Shortcut=i
4\Name=\x7b5b\x9009|\x6587\x4ef6
4\Command="
    copyq:
    var filter_ = '(?=^file://)'
    if (filter() == filter_)
      filter('')
    else
      filter('') & filter(filter_)"
4\InMenu=true
4\Icon=\xf15b
4\Shortcut=f
5\Name=\x7b5b\x9009|URL
5\Command="
    copyq:
    var filter_ = '^(?=(https?|ftps?|smb|mailto)://)'
    if (filter() == filter_)
      filter('')
    else
      filter('') & filter(filter_)"
5\InMenu=true
5\Icon=\xf0c1
5\Shortcut=u
6\Name=\x7b5b\x9009|HTML
6\Command="
    copyq:
    var filter_ = '^text/html$'
    if (filter() == filter_)
      filter('')
    else
      filter('') & filter(filter_)"
6\InMenu=true
6\Icon=\xf121
6\Shortcut=h
7\Name=\x7b5b\x9009|\x624b\x673a\x53f7/\x90ae\x7bb1
7\Command="
    copyq:
    var filter_ = '(^0{0,1}(13[0-9]|15[7-9]|153|156|18[7-9])[0-9]{8}$)|(^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$)'
    if (filter() == filter_)
      filter('')
    else
      filter('') & filter(filter_)"
7\InMenu=true
7\Icon=\xe527
7\Shortcut=p
8\Name=\x6392\x5e8f\xff08\x9009\x4e2d\xff09|\x6700\x65b0\x5728\x524d
8\Command="
    copyq:
    var sel = ItemSelection().current()
    const texts = sel.itemsFormat(\"application/x-copyq-user-copy-time\")
    sel.sort(function(i,j){
        return texts[i] > texts[j];
    });"
8\InMenu=true
8\Icon=\xf017
9\Name=\x6392\x5e8f\xff08\x9009\x4e2d\xff09|\x6700\x65e7\x5728\x524d
9\Command="
    copyq:
    var sel = ItemSelection().current()
    const texts = sel.itemsFormat(\"application/x-copyq-user-copy-time\")
    sel.sort(function(i,j){
        return texts[i] < texts[j];
    });"
9\InMenu=true
9\Icon=\xf1da
10\Name=\x6392\x5e8f\xff08\x9009\x4e2d\xff09|\x5b57\x6bcd\x987a\x5e8f
10\Command="
    copyq:
    var sel = ItemSelection().current()
    const texts = sel.itemsFormat(mimeText);
    sel.sort(function(i,j){
        return texts[i] < texts[j];
    });"
10\InMenu=true
10\Icon=\xf15d
11\Name=\x6392\x5e8f\xff08\x9009\x4e2d\xff09|\x5b57\x6bcd\x5012\x5e8f
11\Command="
    copyq:
    var sel = ItemSelection().current()
    const texts = sel.itemsFormat(mimeText);
    sel.sort(function(i,j){
        return texts[i] > texts[j];
    });"
11\InMenu=true
11\Icon=\xf881
12\Name=\x6392\x5e8f\xff08\x6240\x6709\xff09|\x6700\x65b0\x5728\x524d
12\Command="
    copyq:
    var sel = ItemSelection().selectAll();
    const texts = sel.itemsFormat(\"application/x-copyq-user-copy-time\");
    sel.sort(function(i,j){
        return texts[i] > texts[j];
    });"
12\InMenu=true
12\Icon=\xf017
13\Name=\x6392\x5e8f\xff08\x6240\x6709\xff09|\x6700\x65e7\x5728\x524d
13\Command="
    copyq:
    var sel = ItemSelection().selectAll();
    const texts = sel.itemsFormat(\"application/x-copyq-user-copy-time\");
    sel.sort(function(i,j){
        return texts[i] < texts[j];
    });"
13\InMenu=true
13\Icon=\xf1da
14\Name=\x6392\x5e8f\xff08\x6240\x6709\xff09|\x5b57\x6bcd\x987a\x5e8f
14\Command="
    copyq:
    var sel = ItemSelection().selectAll();
    const texts = sel.itemsFormat(mimeText);
    sel.sort(function(i,j){
        return texts[i] < texts[j];
    });"
14\InMenu=true
14\Icon=\xf15d
15\Name=\x6392\x5e8f\xff08\x6240\x6709\xff09|\x5b57\x6bcd\x5012\x5e8f
15\Command="
    copyq:
    var sel = ItemSelection().selectAll();
    const texts = sel.itemsFormat(mimeText);
    sel.sort(function(i,j){
        return texts[i] > texts[j];
    });"
15\InMenu=true
15\Icon=\xf881
16\Name=----------------------------------
16\Command="
    copyq:
    // \x865a\x62df\x5206\x5272\x7ebf


    "
16\InMenu=true
17\Name=\x53e6\x5b58\x4e3a
17\Command="
    copyq:
    var defaultPath = Dir().homePath()
    var customPath = '/Desktop'
    var suffices = {
      'image/svg': 'svg',
      'image/png': 'png',
      'image/jpeg': 'jpg',
      'image/jpg': 'jpg',
      'image/bmp': 'bmp',
      'text/html': 'html',
      'text/plain' : 'txt',
    }

    if (customPath) {
        currentpath(customPath)
    }
    else {
        currentpath(defaultPath)
    }

    function hasSuffix(fileName)
    {
      return /\\.[0-9a-zA-z]+$/.test(fileName);
    }
    function addSuffix(fileName, format)
    {
      var suffix = suffices[format]
      return suffix ? fileName + \".\" + suffix : fileName
    }
    function filterFormats(format)
    {
      return /^[a-z]/.test(format) && !/^application\\/x/.test(format)
    }
    function itemFormats(row)
    {
      return str(read('?', row))
        .split('\\n')
        .filter(filterFormats)
    }
    function formatPriority(format)
    {
      var k = Object.keys(suffices);
      var i = k.indexOf(format);
      return i === -1 ? k.length : i
    }
    function reorderFormats(formats)
    {
      formats.sort(function(lhs, rhs){
        var i = formatPriority(lhs);
        var j = formatPriority(rhs);
        return i === j ? lhs.localeCompare(rhs) : i - j;
      })
    }
    if (selectedtab()) tab(selectedtab())
    var row = selectedtab() ? currentitem() : -1
    var formats = itemFormats(row)
    reorderFormats(formats)
    var defaultFileName = dateString('yyyy-MM-dd ')+'\x672a\x547d\x540d'
    var keyFormat = '\x683c\x5f0f'
    var keyFileName = '\x6587\x4ef6\x540d'
    var defaultFormat = formats[0]
    var result = dialog(
      '.title', '\x53e6\x5b58\x4e3a...',
      '.width', 300,
      keyFormat, [defaultFormat].concat(formats),
      keyFileName, File(defaultFileName)
    ) || abort()
    var fileName = result[keyFileName]
    var format = result[keyFormat]
    if (!format || !fileName)
      abort()
    if (!hasSuffix(fileName))
      fileName = addSuffix(fileName, format)
    var f = File(fileName)
    if (!f.open()) {
      popup('\x6253\x5f00\x5931\x8d25 \"' + f.fileName() + '\"', f.errorString())
      abort()
    }
    f.write(selectedtab() ? getitem(currentitem())[format] : clipboard(format))
    popup(\"\x4fdd\x5b58\x6210\x529f\", '\x6761\x76ee\x5df2\x4fdd\x5b58\x4e3a \"' + f.fileName() + '\".')"
17\InMenu=true
17\Shortcut=ctrl+s
18\Name=\x64a4\x9500\x5220\x9664
18\Command="
    copyq:
    var trash_tab = '\x56de\x6536\x7ad9'
    var tab_mime = 'application/x-copyq-user-tab'
    var index_mime = 'application/x-copyq-user-index'
    var time_mime = 'application/x-copyq-user-time'
    var remove_mime = [tab_mime, index_mime, time_mime]
    tab(trash_tab)
    if (length() == 0) {
        popup('\x6ca1\x6709\x53ef\x64a4\x9500\x7684\x5220\x9664\xff01')
        abort()
    }
    var item = getItem(0)
    var target_tab = str(item[tab_mime]) || selectedtab()
    var time = str(item[time_mime])
    var items = []
    tab(trash_tab)
    var target_index = 999999
    var i = 0
    while (true) {
        target_index = Math.min(target_index, item[index_mime] || 0)
        for (var j in remove_mime)
            delete item[remove_mime[j]]
        items.push(item)
        item = getitem(++i)
        if ( !time || time !== str(item[time_mime]) )
            break;
    }
    var select_items = []
    var remove_items = []
    for (var j = 0; j < i; ++j) {
        select_items.push(target_index + j)
        remove_items.push(j)
    }
    show(target_tab)
    tab(target_tab)
    items.unshift(target_index)
    insert.apply(this, items)
    selectItems.apply(this, select_items)
    tab(trash_tab)
    remove.apply(this, remove_items)"
18\InMenu=true
18\Icon=\xf0e2
18\Shortcut=ctrl+z
19\Name=\x5220\x9664\x81f3\x56de\x6536\x7ad9
19\Command="
    copyq:
    var trash_tab = '\x56de\x6536\x7ad9'
    var tab_mime = 'application/x-copyq-user-tab'
    var index_mime = 'application/x-copyq-user-index'
    var time_mime = 'application/x-copyq-user-time'

    var source_tab = selectedtab()
    var time = (new Date).toISOString()

    tab(source_tab)
    var sel = ItemSelection().current()
    var pinned = []
    const rows = sel.rows()
    if (rows.length === 0)
        abort()
    if (source_tab != trash_tab) {
        var trashed = []
        for (var i = 0; i < sel.length; ++i) {
            if (plugins.itempinned.isPinned(rows[i])) {
                pinned.push(i)
            }
            else {
                var item = sel.itemAtIndex(i)
                // Workaround: Convert QByteArray to ByteArray.
                for (var format in item)
                    item[format] = ByteArray(item[format])
                item[tab_mime] = source_tab
                item[index_mime] = rows[i]
                item[time_mime] = time
                trashed.push(item)
            }
        }
        if (pinned.length > 0) {
            sel.deselectIndexes(pinned)
            for (var i = 0; i < pinned.length; i++) {
              pinned[i] = pinned[i] + 1
            }
            popup('\x56fa\x5b9a\x7684\x6761\x76ee\x4e0d\x4f1a\x88ab\x5220\x9664  ', '\x9009\x62e9\x4e2d\x7684\x7b2c ' + pinned + ' \x6761\x5df2\x56fa\x5b9a\x3002', time = 2000)
        }
        tab(trash_tab)
        write(0, trashed)
        tab(source_tab)
        sel.removeAll()
    }
    else {
        var text = dialog(
            '.title', '\x5220\x9664\xff1f',
            '.label', '\x65e0\x6cd5\x64a4\x9500\xff01',
            '.combo:\x786e\x8ba4 ', ['\x662f', '\x5426']
        )
        if (text == '\x662f') {
            sel.removeAll()
        }
    }

    var newCurrentRow = rows[0]
    if (newCurrentRow >= length())
        newCurrentRow = length() - 1
    selectItems(newCurrentRow)"
19\InMenu=true
19\Icon=\xf2ed
19\Shortcut=del
20\Name=\x6e05\x7406\x5f53\x524d\x6807\x7b7e\x9875
20\MatchCommand="
    copyq: tab(selectedTab()); if (size() == 0) fail()"
20\Command="
    copyq:
    var trash_tab = '\x56de\x6536\x7ad9'
    var tab_mime = 'application/x-copyq-user-tab'
    var index_mime = 'application/x-copyq-user-index'
    var time_mime = 'application/x-copyq-user-time'

    var source_tab = selectedtab()
    var time = (new Date).toISOString()

    tab(source_tab)
    var sel = ItemSelection(selectedTab()).selectRemovable()
    var pinned = []
    const rows = sel.rows()
    if (rows.length === 0)
        abort()
    if (source_tab != trash_tab) {
        var trashed = []
        for (var i = 0; i < sel.length; ++i) {
            if (plugins.itempinned.isPinned(rows[i])) {
                pinned.push(i)
            }
            else {
                var item = sel.itemAtIndex(i)
                // Workaround: Convert QByteArray to ByteArray.
                for (var format in item)
                    item[format] = ByteArray(item[format])
                item[tab_mime] = source_tab
                item[index_mime] = rows[i]
                item[time_mime] = time
                trashed.push(item)
            }
        }
        if (pinned.length > 0) {
            sel.deselectIndexes(pinned)
            for (var i = 0; i < pinned.length; i++) {
              pinned[i] = pinned[i] + 1
            }
            popup('\x56fa\x5b9a\x7684\x6761\x76ee\x4e0d\x4f1a\x88ab\x5220\x9664  ', '\x7b2c ' + pinned + ' \x6761\x5df2\x56fa\x5b9a\x3002', time = 2000)
        }
        tab(trash_tab)
        write(0, trashed)
        tab(source_tab)
        sel.removeAll()
    }
    else {
        var text = dialog(
            '.title', '\x6e05\x7406\xff1f',
            '.label', '\x65e0\x6cd5\x64a4\x9500\xff01',
            '.combo:\x786e\x8ba4 ', ['\x662f', '\x5426']
        )
        if (text == '\x662f') {
            ItemSelection(selectedTab()).selectRemovable().removeAll()
        }
    }

    var newCurrentRow = rows[0]
    if (newCurrentRow >= length())
        newCurrentRow = length() - 1
    selectItems(newCurrentRow)"
20\InMenu=true
20\Icon=\xf51a
21\Name=----------------------------------
21\Command="
    copyq:
    // \x865a\x62df\x5206\x5272\x7ebf

    "
21\InMenu=true
22\Name=\x56fa\x5b9a
22\Command="
    copyq: plugins.itempinned.pin()"
22\Input=!OUTPUT
22\Output=application/x-copyq-item-pinned
22\InMenu=true
22\Icon=\xf08d
22\Shortcut=shift+p
22\InternalId=copyq_pinned_pin
23\Name=\x89e3\x9664\x56fa\x5b9a
23\Command="
    copyq: plugins.itempinned.unpin()"
23\Input=application/x-copyq-item-pinned
23\InMenu=true
23\Icon=\xf08d
23\Shortcut=shift+p
23\InternalId=copyq_pinned_unpin
24\Name=\x5207\x6362\x9ad8\x4eae
24\MatchCommand="
    copyq:
    var color = 'rgba(255, 255, 0, 0.5)'
    var currentColor = str(selectedItemData(0)[mimeColor])
    if (currentColor != color) {
        menuItem['text'] = '\x9ad8\x4eae'
        menuItem['tag'] = '__'
        menuItem['color'] = color.replace(/\\d+\\.\\d+/, 1)
    } else {
        menuItem['text'] = '\x53d6\x6d88\x9ad8\x4eae'
        menuItem['tag'] = 'x'
        menuItem['color'] = 'white'
    }
    menuItem['icon'] = '\xf591'"
24\Command="
    copyq:
    var color = 'rgba(255, 255, 0, 0.5)'
    var currentColor = str(selectedItemData(0)[mimeColor]);
    if (currentColor != color) {
        setData(mimeColor, color)
    } else {
        removeData(mimeColor)
    }"
24\InMenu=true
24\Enable=false
24\Icon=\xf591
24\Shortcut=ctrl+m
25\Name=\x5207\x6362\x201c\x91cd\x8981\x201d\x6807\x7b7e
25\Command="
    copyq:
    var tag = decodeURIComponent('\x91cd\x8981')
    if (plugins.itemtags.hasTag(tag))
        plugins.itemtags.untag(tag)
    else
        plugins.itemtags.tag(tag)"
25\InMenu=true
25\Icon=\xf02e
26\Name=\x6807\x8bb0\x4e3a \x201c\x91cd\x8981\x201d
26\MatchCommand="
    copyq: plugins.itemtags.hasTag(decodeURIComponent('%E9%87%8D%E8%A6%81')) && fail()"
26\Command="
    copyq: plugins.itemtags.tag(decodeURIComponent('%E9%87%8D%E8%A6%81'))"
26\InMenu=true
26\Enable=false
26\Icon=\xf02b
26\InternalId=copyq_tags_tag:\x91cd\x8981
27\Name=\x79fb\x9664\x6807\x8bb0 \x201c\x91cd\x8981\x201d
27\MatchCommand="
    copyq: plugins.itemtags.hasTag(decodeURIComponent('%E9%87%8D%E8%A6%81')) || fail()"
27\Command="
    copyq: plugins.itemtags.untag(decodeURIComponent('%E9%87%8D%E8%A6%81'))"
27\InMenu=true
27\Enable=false
27\Icon=\xf02b
27\InternalId=copyq_tags_untag:\x91cd\x8981
28\Name=\x6dfb\x52a0\x4e00\x4e2a\x6807\x8bb0
28\Command="
    copyq: plugins.itemtags.tag()"
28\InMenu=true
28\Icon=\xf02b
28\Shortcut=shift+t
28\InternalId=copyq_tags_tag
29\Name=\x79fb\x9664\x4e00\x4e2a\x6807\x8bb0
29\Command="
    copyq: plugins.itemtags.untag()"
29\Input=application/x-copyq-tags
29\InMenu=true
29\Icon=\xf068
29\InternalId=copyq_tags_untag
30\Name=\x6e05\x7406\x6240\x6709\x6807\x8bb0
30\Command="
    copyq: plugins.itemtags.clearTags()"
30\Input=application/x-copyq-tags
30\InMenu=true
30\Icon=\xf02c
30\InternalId=copyq_tags_clear
31\Name=----------------------------------
31\Command="
    copyq:
    // \x865a\x62df\x5206\x5272\x7ebf

    "
31\InMenu=true
32\Name=\x7c98\x8d34\x4e3a\x7eaf\x6587\x672c
32\Command="
    copyq:
    var text = input()
    copy(text)
    copySelection(text)
    paste()"
32\Input=text/plain
32\InMenu=true
32\HideWindow=true
32\Icon=\xf0ea
32\Shortcut=shift+v
33\Name=\x6e05\x7406\x683c\x5f0f\x5e76\x7c98\x8d34
33\Command="
    copyq:

    var text = str(input())

    if (!text) {
      try {
        copy()
      } catch (e) {
        popup('\x590d\x5236\x5931\x8d25\xff0c\x8bf7\x91cd\x65b0\x9009\x62e9\x6587\x672c\xff01', e, time=2000)
        abort() 
      }
      text = str(clipboard())
    }

    copy(format(text))
    paste()

    function format(text) {
        //\x5168\x89d2\x8f6c\x534a\x89d2
        text = ToCDB(text).trim()
        // \x5220\x9664\x6240\x6709\x56de\x8f66\x6362\x884c\x7b26
        text = text.replace(new RegExp(/[\\r\\n]+/g), ' ')
        // \x4e24\x4e2a\x4ee5\x4e0a\x7684\x7a7a\x683c\x66ff\x6362\x6210\x4e00\x4e2a
        text = text.replace(new RegExp(/\\s+/g), ' ')
        // \x5220\x9664\x5355\x4e2a\x5b57\x6bcd\xff08\x41/a\x9664\x5916\xff09\x4e4b\x95f4\x7684\x7a7a\x683c
        text = text.replace(/([^Aa])\\s(?!\\S{2,}|A|a)/g,'$1')
        return text
    }

    function ToCDB(str) { 
        var tmp = \"\"
        for(var i=0;i<str.length;i++){ 
            if (str.charCodeAt(i) == 12288){
                tmp += String.fromCharCode(str.charCodeAt(i)-12256)
                continue
            }
            if(str.charCodeAt(i) > 65280 && str.charCodeAt(i) < 65375){ 
                tmp += String.fromCharCode(str.charCodeAt(i)-65248)
            } 
            else{ 
                tmp += String.fromCharCode(str.charCodeAt(i))
            } 
        } 
        return tmp 
    }"
33\Input=text/plain
33\InMenu=true
33\IsGlobalShortcut=true
33\HideWindow=true
33\Icon=\xf12d
33\GlobalShortcut=alt+shift+f
34\Name=\x5408\x5e76\x6240\x9009\x9879
34\Command="
    copyq add -- %1
    "
34\InMenu=true
35\Name=\x7528\x6d4f\x89c8\x5668\x6253\x5f00
35\Match="^(?=(https?|ftps?|smb|mailto)://)(?=\\S{12,})"
35\Command="
    copyq open %1"
35\InMenu=true
35\HideWindow=true
35\Icon=\xf0ac
35\Shortcut=ctrl+b
36\Name=----------------------------------
36\Command="
    copyq:
    // \x865a\x62df\x5206\x5272\x7ebf

    "
36\InMenu=true
37\Name=\x5207\x6362\x5355\x884c\x6a21\x5f0f
37\MatchCommand="
    copyq:
    var on = config(\"show_simple_items\") === \"true\"
    if (on) {
      menuItem['text'] = '\x591a\x884c\x6a21\x5f0f'
      menuItem['icon'] = '\xf065'
    } else {
      menuItem['text'] = '\x5355\x884c\x6a21\x5f0f'
      menuItem['icon'] = '\xf066'
    }"
37\Command="
    copyq:
    var row = selectedItems()
    var on = config(\"show_simple_items\") === \"true\"
    config(\"show_simple_items\", !on)
    selectItems(row)"
37\InMenu=true
37\Icon=\xf066
37\Shortcut=f8
38\Name=\x81ea\x52a8\x9884\x89c8\x56fe\x7247/\x957f\x6587\x672c
38\MatchCommand="
    copyq:
    // \x5f00\x542f\x81ea\x52a8\x9884\x89c8
    var auto_preview = true

    if (auto_preview) {

        // \x9884\x89c8\x56fe\x7247
        var preview_image = true
        // \x9884\x89c8\x957f\x6587\x672c\xff0c\x8c03\x6574\x5b57\x6570\x548c\x884c\x6570\x4ee5\x9002\x5e94\x9996\x9009\x9879\x4e2d\x6587\x672c\x7684\x6700\x5927\x9ad8\x5ea6
        var preview_longText = true
        // \x957f\x6587\x672c\x5b57\x6570
        var LongTextCharacters = 100
        // \x957f\x6587\x672c\x884c\x6570
        var LongTextLines = 2

        if (visible()) {
            var format = str(dataFormats())
            var content = str(data(mimeUriList)) || str(data(mimeText))
            if (preview_image && (format.match(/image\\/.*/)
                    || content.match(/^file:.*(png|jpe?g|bmp|svg|gif)$/))
                ||
                preview_longText && (content.length > LongTextCharacters
                    || countLines(content) > LongTextLines)) {
                preview(true)
            } else {
                preview(false)
            }
        }

        function countLines(str) {
            var newLine = str.match(/\\n/g)
            return newLine ? newLine.length + 1 : 1
        }
    }
    "
38\Command="
    copyq:
    preview(false) || preview(true)"
38\InMenu=true
38\Icon=\xf06e
38\Shortcut=space
39\Name=\x526a\x8d34\x677f\x7c98\x8d34\x4e3a\x7eaf\x6587\x672c
39\Command="
    copyq: 
    var text = clipboard()
    copy(text)
    copySelection(text)
    paste()"
39\IsGlobalShortcut=true
39\Icon=T
39\GlobalShortcut=ctrl+shift+v
39\InternalId=copyq_global_paste_clipboard_plain
40\Name=\x7c98\x8d34\x5e76\x590d\x5236\x4e0a\x4e00\x9879
40\Command="
    copyq: paste(); previous()"
40\IsGlobalShortcut=true
40\Icon=\xf0aa
40\GlobalShortcut=ctrl+shift+j
40\InternalId=copyq_global_paste_copy_previous
41\Name=\x7c98\x8d34\x5e76\x590d\x5236\x4e0b\x4e00\x9879
41\Command="
    copyq: paste(); next()"
41\IsGlobalShortcut=true
41\Icon=\xf0ab
41\GlobalShortcut=ctrl+shift+k
41\InternalId=copyq_global_paste_copy_next
42\Name=\x7c98\x8d34\x7b2cN\x9879
42\Command="
    copyq:
    var n = str(data(mimeShortcut)).slice(-1)
    select(n)
    paste()"
42\IsGlobalShortcut=true
42\Enable=false
42\Icon=\xf0cb
42\GlobalShortcut=ctrl+shift+0, ctrl+shift+1, ctrl+shift+2, ctrl+shift+3, ctrl+shift+4, ctrl+shift+5, ctrl+shift+6, ctrl+shift+7, ctrl+shift+8, ctrl+shift+9
43\Name=----------------------------------
43\Command="
    copyq:
    // \x865a\x62df\x5206\x5272\x7ebf
    "
43\InMenu=true
43\Enable=false
44\Name=\x7c98\x8d34\x5f53\x524d\x65e5\x671f\x548c\x65f6\x95f4
44\Command="
    copyq:
    var time = dateString('yyyy'+'\x5e74'+'MM'+'\x6708'+'dd'+'\x65e5 '+'hh:mm')
    copy(time)
    paste()"
44\IsGlobalShortcut=true
44\Icon=\xf017
44\GlobalShortcut=alt+shift+t
45\Name=\x5207\x6362 \x5927\x5199/\x5c0f\x5199/\x9996\x5b57\x6bcd\x5927\x5199
45\Command="
    copyq:
    try {
        copy()
    } catch (e) {
        popup('\x590d\x5236\x5931\x8d25\xff0c\x8bf7\x91cd\x65b0\x9009\x62e9\x6587\x672c\xff01', e)
        abort()
    }

    var text = str(clipboard())

    var UpperCase = text.toUpperCase()
    var LowerCase = text.toLowerCase()
    var TitleCase = toTitleCase(text)

    if (text == UpperCase) {
      text = LowerCase
    }
    else {
      if (text == LowerCase) {
        text = TitleCase
      }
      else
         text=UpperCase
    }

    copy(text)
    paste()

    function toTitleCase(str) {
      return str.replace(
        /\\w\\S*/g,
        function(txt) {
          return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
        }
      );
    }"
45\IsGlobalShortcut=true
45\Icon=\xf034
45\GlobalShortcut=meta+ctrl+u
46\Name=\x663e\x793a/\x9690\x85cf\x4e3b\x7a97\x53e3
46\Command="
    copyq:
    // \x7559\x7a7a\x663e\x793a\x4e0a\x6b21\x6253\x5f00\x7684\x6807\x7b7e\x9875
    var tabName = '\x526a\x8d34\x677f'
    // \x5c45\x4e2d\x663e\x793a\x7a97\x53e3
    var center = true
    // \x5728\x9f20\x6807\x5149\x6807\x4e0b\x663e\x793a\x7a97\x53e3\xff0c\x5173\x95ed\x5c45\x4e2d\x65f6\x751f\x6548
    var showAtCursor = true
    // \x5c4f\x5e55\x5206\x8fa8\x7387
    var resolution = { w:1920, h:1080  }
    // \x7a97\x53e3\x5927\x5c0f\xff0c\x5c45\x4e2d\x7a97\x53e3\x65f6\x751f\x6548
    var windowSize = { w:400, h:500 }
    var windowPotion = { x:0, y:0 }

    // Qt\x7f29\x653e\x7cfb\x6570\xff08\x4f30\x7b97\x503c\xff09
    const Qt_Scale_Factor = 1.3
    // \x7cfb\x7edf\x7f29\x653e\x7cfb\x6570\xff0c\x31\x30\x30%=1.0\xff0c\x31\x32\x35%=1.25
    var sys_Scale_Factor = 1.0
    // \x7a97\x53e3\x7f29\x653e\x7cfb\x6570=Qt\x7f29\x653e*\x7cfb\x7edf\x7f29\x653e^2
    var scaleFactor = Qt_Scale_Factor * (sys_Scale_Factor * sys_Scale_Factor)

    if (visible()) {
        hide()
    }
    else {
      if (center) {
        windowPotion.x = Math.round( (resolution.w - windowSize.w * scaleFactor) / 2 )
        windowPotion.y = Math.round( (resolution.h - windowSize.h * scaleFactor) / 2 )
        showAt( windowPotion.x, windowPotion.y, windowSize.w, windowSize.h, tabName )
      }
      else {
         showAtCursor? showAt(): show()
      }
    }
        "
46\IsGlobalShortcut=true
46\Icon=\xf2d2
46\GlobalShortcut=alt+v
47\Name=----------------------------------
47\Command="
    copyq:
    // \x865a\x62df\x5206\x5272\x7ebf

    "
47\InMenu=true
47\Enable=false
48\Name=Linkify
48\Match=^(https?|ftps?|file|mailto|smb)://
48\Command="
    copyq:
    const link = str(input());
    const href = `<a href=\"${link}\">${link}</a>`;
    setData('text/html', href);"
48\Input=text/plain
48\Automatic=true
48\Icon=\xf0c1
49\Name=\x590d\x5236\x43opyQ\x547d\x4ee4\x65f6\x5f39\x51fa\x901a\x77e5
49\Match=^\\[Commands?\\]|https?://github\\.com/.*/copyq-commands/blob/.*\\.ini
49\Command="
    copyq:
    // Imports raw commands code (starting with [Command] or [Commands])
    // or from a link ('https://github.com/**/copyq-commands/blob/**.ini').
    var timeOutSeconds = 10
    var rawDataUrlPrefix = 'https://raw.githubusercontent.com'
    // Don't run this when mouse selection changes.
    if ( dataFormats().indexOf(mimeClipboardMode) != -1 )
      abort()
    function importCommandsFromUrl(url)
    {
      var m = url.match(/^https?:\\/\\/github\\.com(\\/.*)\\/blob(\\/.*\\.ini)/)
      if (!m)
        return;
      var rawDataUrl = rawDataUrlPrefix + m[1] + m[2]
      var reply = networkGet(rawDataUrl)
      var commandsData = str(reply.data)
      if (reply.status != 200) {
        throw '\x547d\x4ee4\x83b7\x53d6\x5931\x8d25\xff01'
            + '\\nStatus code: ' + reply.status
            + '\\nError: ' + reply.error
      }
      if ( !commandsData.match(/^\\[Commands?\\]/) )
        return;
      return importCommands(commandsData);
    }
    var cmds = importCommandsFromUrl(str(input())) || importCommands(input())
    var list = '<ul>'
    for (var i in cmds) {
      var cmd = cmds[i]
      var cmdType =
        cmd.automatic ? 'automatic' :
        cmd.inMenu ? 'menu/shortcut' :
        cmd.globalShortcuts ? 'global shortcut' : '<b>???</b>';
      list += '<li>' + escapeHtml(cmds[i].name) + ' (' + cmdType + ')</li>'
    }
    list += '</ul>'
    var message = '<p>\x4ece\x526a\x8d34\x677f<b>\x5bfc\x5165</b>\x547d\x4ee4\xff1f</p>' + list
    notification(
      '.title', '\x6709\x53ef\x7528\x7684\x43opyQ\x547d\x4ee4',
      '.message', message,
      '.time', timeOutSeconds*1000,
      '.icon', '\xf085',
      '.id', 'CopyQ_commands_in_clipboard',
      '.button', '\x53d6\x6d88', '', '',
      '.button', '\x5bfc\x5165', 'copyq: addCommands( importCommands(input()) )', exportCommands(cmds)
    )"
49\Input=text/plain
49\Automatic=true
49\Icon=\xf085
50\Name=\x5ffd\x7565 *\"\x5bc6\x7801\"* \x7a97\x53e3
50\Window=KeePass(XC)?$
50\Command="
    copyq ignore"
50\Automatic=true
50\Remove=true
50\Icon=*
51\Name=\x4fdd\x5b58\x590d\x5236\x65f6\x95f4
51\Command="
    copyq:
    var time = dateString('yyyy-MM-dd hh:mm:ss')
    setData('application/x-copyq-user-copy-time', time)

    var tagsMime = 'application/x-copyq-tags'
    var tags = str(data(tagsMime)) + ', ' + time
    setData(tagsMime, tags)"
51\Automatic=true
51\Icon=\xf017
52\Name=\x590d\x5236\x6587\x4ef6/URIs
52\Input=text/uri-list
52\Automatic=true
52\Icon=\xf0c1
53\Name=\x56fe\x7247\x6807\x7b7e\x9875
53\Command="
    copyq:
    var imageTab = '\x56fe\x7247'
    var formats = dataFormats()
    for (var i in formats) {
        if (formats[i].match(/^image\\//)) {
            setData(mimeOutputTab, imageTab)
            break
        }
    }"
53\Automatic=true
53\Enable=false
53\Icon=\xf03e
54\Name=\x5927\x6587\x4ef6\x6807\x7b7e\x9875
54\Command="
    copyq:
    var tabName = '\x5927\x6587\x4ef6'
    var minBytes = 250*1000
    function hasBigData() {
        var itemSize = 0
        var formats = dataFormats()
        for (var i in formats) {
            itemSize += data(formats[i]).size()
            if (itemSize >= minBytes)
                return true
        }
        return false
    }
    if (hasBigData()) {
        setData(mimeOutputTab, tabName)
    }"
54\Automatic=true
54\Enable=false
54\Icon=\xf1c0
55\Name=\x590d\x5236\x65f6\x56fe\x6807\x7ea2\x70b9\x63d0\x793a
55\Command="
    var timeMs = 10000;
    var iconTags = [
        '\xf111',
        ' \xf111',
        '  \xf111',
        '',
    ]
    function clipboardNotification() {
        var id = Number(settings('icon-activation-id') || 0) + 1;
        settings('icon-activation-id', id);
        iconTagColor('red');
        for (const tag of iconTags.values()) {
            if ( settings('icon-activation-id') != id )
                break;
            iconTag(tag);
            sleep(timeMs);
        }
    }
    onClipboardChanged_ = onClipboardChanged
    onClipboardChanged = function() {
        onClipboardChanged_()
        clipboardNotification()
    }
    onOwnClipboardChanged_ = onOwnClipboardChanged
    onOwnClipboardChanged = function() {
        onOwnClipboardChanged_()
        clipboardNotification()
    }
    onHiddenClipboardChanged_ = onHiddenClipboardChanged
    onHiddenClipboardChanged = function() {
        onHiddenClipboardChanged_()
        clipboardNotification()
    }"
55\IsScript=true
55\Icon=\xf0c4
56\Name=\x5ffd\x7565\x7a7a\x5b57\x7b26\x6216\x5355\x4e2a\x5b57\x7b26\x7684\x6761\x76ee
56\Command="
    function hasEmptyOrSingleCharText() {
        if (dataFormats().includes(mimeText)) {
            var text = str(data(mimeText));
            if (text.match(/^\\s*.?\\s*$/)) {
                serverLog('Ignoring text with single or no character');
                return true;
            }
        }
        return false;
    }

    var onClipboardChanged_ = onClipboardChanged;
    onClipboardChanged = function() {
        if (!hasEmptyOrSingleCharText()) {
            onClipboardChanged_();
        }
    }

    var synchronizeFromSelection_ = synchronizeFromSelection;
    synchronizeFromSelection = function() {
        if (!hasEmptyOrSingleCharText()) {
            synchronizeFromSelection_();
        }
    }

    var synchronizeToSelection_ = synchronizeToSelection;
    synchronizeToSelection = function() {
        if (!hasEmptyOrSingleCharText()) {
            synchronizeToSelection_();
        }
    }
        "
56\IsScript=true
56\Icon=\xf06a
57\Name=\x542f\x52a8\x65f6\x663e\x793a\x4e3b\x7a97\x53e3
57\Command="
    var onStartPrevious = global.onStart
    global.onStart = function() {
        onStartPrevious()
        show()
    }"
57\IsScript=true
57\Enable=false
57\Icon=\xf2d0
58\Name=\x95f4\x9694\x33\x30\x79d2\x540e\x6e05\x7a7a\x7cfb\x7edf\x526a\x8d34\x677f
58\Command="
    var timeoutSeconds = 30;
    function option() {
        return isClipboard()
            ? 'clear_clipboard/clipboard_change_counter'
            : 'clear_clipboard/selection_change_counter'
    }
    function getCount() {
        return Number(settings(option())) || 0
    }
    function bumpCounter() {
        var counter = getCount() + 1
        settings(option(), counter)
        return counter
    }
    function resetLater(counter) {
        for (var i = 0; i < timeoutSeconds && counter == getCount(); ++i) {
            sleep(1000)
        }
        if (counter != getCount())
            return
        if (isClipboard())
            copy('')
        else
            copySelection('')
    }
    var onClipboardChanged_ = onClipboardChanged
    onClipboardChanged = function() {
        var counter = bumpCounter()
        onClipboardChanged_()
        resetLater(counter)
    }
    var onOwnClipboardChanged_ = onOwnClipboardChanged
    onOwnClipboardChanged = function() {
        var counter = bumpCounter()
        onOwnClipboardChanged_()
        resetLater(counter)
    }"
58\IsScript=true
58\Enable=false
58\Icon=\xf2f2
59\Name=\x9884\x89c8\x56fe\x7247\x6587\x4ef6
59\Command="
    copyq:
    var prefix = 'file:///'
    var suffixToMime = {
        'png': 'image/png',
        'jpg': 'image/jpeg',
        'jpeg': 'image/jpeg',
        'bmp': 'image/bmp',
        'gif': 'image/gif',
        'svg': 'image/svg+xml',
    }
    function startsWith(text, what) {
        return what === text.substring(0, what.length)
    }
    function tryShowImage(mime) {
        var text = str(data(mime))
        if ( !startsWith(text, prefix) )
            return false
        var i = text.lastIndexOf('.')
        if (i == -1)
            return false
        var suffix = text.substring(i + 1)
        var imageMime = suffixToMime[suffix]
        if (imageMime === undefined)
            return false
        var path = text.substring(prefix.length)
        var f = new File(path)
        if ( !f.openReadOnly() )
            return false
        var imageData = f.readAll()
        f.close()
        if ( imageData.size() === 0 )
            return false
        setData(mimeItemNotes, path)
        setData(imageMime, imageData)
        return true
    }
    tryShowImage(mimeText)
        || tryShowImage(mimeUriList)"
59\Display=true
59\Icon=\xf1c5
60\Name=\x7eaf\x6587\x672c\x989c\x8272\x6807\x8bb0
60\Command="
    copyq:
    if ( str(data(mimeText)) && !str(data(mimeHtml)) ) {
        html = escapeHtml(data(mimeText))
        setData(mimeHtml, '<span style=\"color:#4872B7\">' + html + '</span>')
    }"
60\Display=true
60\Icon=\xf15b
size=60