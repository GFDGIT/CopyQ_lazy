[Command]
Name=\x6392\x5e8f
Command="
    copyq:
    // \x5355\x9009\x6761\x76ee\x65f6\x5bf9\x6574\x4e2a\x6807\x7b7e\x9875\x8fdb\x884c\x6392\x5e8f
    // \x591a\x9009\x6761\x76ee\x65f6\x5bf9\x9009\x4e2d\x7684\x6761\x76ee\x8fdb\x884c\x6392\x5e8f\xff08\x7f6e\x9876\x56fa\x5b9a\x9009\x9879\x9664\x5916\xff09

    var date_reverse = {
        [mimeText]: '\x6700\x65b0\x5728\x524d',
        [mimeIcon]: '\xf1da',
        format: \"application/x-copyq-user-copy-time\",
        reverse: true
    }

    var date = {
        [mimeText]: '\x6700\x65e7\x5728\x524d',
        [mimeIcon]: '\xf017',
        format: \"application/x-copyq-user-copy-time\",
        reverse: false
    }

    var pinned = {
        [mimeText]: '\x7f6e\x9876\x56fa\x5b9a',
        [mimeIcon]: '\xf08d',
        format: \"application/x-copyq-item-pinned\",
        reverse: false
    }

    var alphabet = {
        [mimeText]: '\x5b57\x6bcd\x987a\x5e8f',
        [mimeIcon]: '\xf15d',
        format: mimeText,
        reverse: false
    }
    var alphabet_reverse = {
        [mimeText]: '\x5b57\x6bcd\x5012\x5e8f',
        [mimeIcon]: '\xf881',
        format: mimeText,
        reverse: true
    }

    var size_reverse = {
        [mimeText]: '\x4ece\x5927\x5230\x5c0f',
        [mimeIcon]: '\xf160',
        format: \"ItemSize\",
        reverse: true
    }

    var size = {
        [mimeText]: '\x4ece\x5c0f\x5230\x5927',
        [mimeIcon]: '\xf884',
        format: \"ItemSize\",
        reverse: false
    }

    var sorts = [
        pinned,
        date_reverse,
        date,
        alphabet,
        alphabet_reverse,
        size_reverse,
        size
    ]
    var selectedIndex = menuItems(sorts)

    var sel = ItemSelection().current()
    if (sel.length <= 1) {
        sel = ItemSelection().selectAll()
    }
    const rows = sel.rows()

    var order = ''
    if (selectedIndex != -1) {
        const selectedFormat = sorts[selectedIndex].format
        switch (selectedFormat) {
            case 'ItemSize':
                popup('\x6392\x5e8f\x4e2d\x23f3', '', rows.length * 3)
                order = Sizelist()
                break;
            case \"application/x-copyq-item-pinned\":
                order = pin_order()
                abort()
            default:
                order = sel.itemsFormat(selectedFormat)
        }
    } else {
        abort()
    }

    sel.sort(function (i, j) {
        if (sorts[selectedIndex].reverse) {
            return order[i] > order[j];
        } else {
            return order[i] < order[j];
        }
    });
    popup('\x6392\x5e8f\x5b8c\x6210\x2705', '', 1000)

    function Sizelist() {
        var items = sel.items()
        var sizes = []
        for (let row in rows) {
            var itemSize = 0
            var item = items[row]
            for (var format in item) {
                itemSize += read(format, row).size()
            }
            sizes.push(itemSize)
        }
        return sizes
    }

    function pin_order() {
        var pinned = []
        var sel = ItemSelection().selectAll()
        var rows = sel.rows()
        for (var i = 0; i < sel.length; ++i) {
            if (plugins.itempinned.isPinned(rows[i]))
                pinned.push(i)
        }
        if (pinned.length > 0) {
            sel.deselectIndexes(pinned)
            sel.invert().move(0)
            selectItems(0)
        } else {
            popup('\x6ca1\x6709\x56fa\x5b9a\x7684\x6761\x76ee\xff01')
        }
    } "
InMenu=true
Icon=\xf0dc
Shortcut=s